import{_ as H,u as O,a as X,A as u,b as r,d as v,e as l,w as t,l as $,f as o,i as w,h,g as n,t as F,j as Q,B as R,H as W,I as Y,F as Z,J as z,s as ee,K as le,k as te,L as ae,M as oe,N as se,O as ne}from"./index-9820d523.js";/* empty css                *//* empty css                  *//* empty css                     *//* empty css                *//* empty css                 */const ue={class:"upload-container"},re={class:"step-content"},ie={key:0,class:"form-container"},de=["src"],pe={key:1,class:"upload-file-container"},ve={key:0,class:"file-info"},ce={class:"step-actions"},_e={key:2,class:"result-container"},me={__name:"NovelUpload",setup(fe){const C=O(),V=X(),b=u(null),s=u({title:"",author:"",description:""}),I={title:[{required:!0,message:"请输入小说标题",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],author:[{required:!0,message:"请输入作者姓名",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],description:[{max:500,message:"长度不超过 500 个字符",trigger:"blur"}]},i=u(0),D=()=>{b.value.validate(a=>{a&&i.value++})},E=()=>{i.value--},g=u(""),M=a=>{const e=new FileReader;e.onload=_=>{g.value=_.target.result},e.readAsDataURL(a.raw)},d=u(null),T=a=>{d.value=a.raw},y=u(!1),k=u(!1),x=u(null),c=u(""),A=async()=>{if(!d.value){R.warning("请选择要上传的小说文件");return}y.value=!0,c.value="";try{const a=new FormData;a.append("title",s.value.title),a.append("author",s.value.author),s.value.description&&a.append("description",s.value.description),a.append("file",d.value);const e=await V.uploadNovelFile(a);k.value=!0,x.value=e.novel_id,await V.fetchNovels(),i.value++}catch(a){k.value=!1,c.value=a.message||"上传失败，请稍后重试",R.error(c.value)}finally{y.value=!1}},L=()=>{x.value&&C.push(`/novels/detail/${x.value}`)},q=()=>{b.value.resetFields(),g.value="",d.value=null,k.value=!1,x.value=null,c.value="",i.value=0},G=()=>{C.push("/novels/list")},J=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(2)+" KB":(a/(1024*1024)).toFixed(2)+" MB";return(a,e)=>{const _=W,K=Y,N=Z,m=z,U=ee,B=le,p=te,P=ae,S=oe,j=$;return r(),v("div",ue,[l(j,{shadow:"never"},{header:t(()=>e[3]||(e[3]=[o("div",{class:"upload-header"},[o("h2",null,"上传小说")],-1)])),default:t(()=>[l(K,{active:i.value,"finish-status":"success","align-center":""},{default:t(()=>[l(_,{title:"基本信息"}),l(_,{title:"上传文件"}),l(_,{title:"处理完成"})]),_:1},8,["active"]),o("div",re,[i.value===0?(r(),v("div",ie,[l(P,{ref_key:"formRef",ref:b,model:s.value,rules:I,"label-width":"100px","status-icon":""},{default:t(()=>[l(m,{label:"小说标题",prop:"title"},{default:t(()=>[l(N,{modelValue:s.value.title,"onUpdate:modelValue":e[0]||(e[0]=f=>s.value.title=f),placeholder:"请输入小说标题"},null,8,["modelValue"])]),_:1}),l(m,{label:"作者",prop:"author"},{default:t(()=>[l(N,{modelValue:s.value.author,"onUpdate:modelValue":e[1]||(e[1]=f=>s.value.author=f),placeholder:"请输入作者姓名"},null,8,["modelValue"])]),_:1}),l(m,{label:"简介",prop:"description"},{default:t(()=>[l(N,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=f=>s.value.description=f),type:"textarea",rows:5,placeholder:"请输入小说简介"},null,8,["modelValue"])]),_:1}),l(m,{label:"封面",prop:"cover"},{default:t(()=>[l(B,{class:"cover-uploader",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":M},{default:t(()=>[g.value?(r(),v("img",{key:0,src:g.value,class:"cover-image"},null,8,de)):(r(),w(U,{key:1,class:"cover-uploader-icon"},{default:t(()=>[l(h(se))]),_:1}))]),_:1}),e[4]||(e[4]=o("div",{class:"upload-tip"}," 支持JPG、PNG格式，建议尺寸：300x400 ",-1))]),_:1}),l(m,null,{default:t(()=>[l(p,{type:"primary",onClick:D},{default:t(()=>e[5]||(e[5]=[n("下一步")])),_:1})]),_:1})]),_:1},8,["model"])])):i.value===1?(r(),v("div",pe,[l(B,{class:"file-uploader",drag:"",action:"#","auto-upload":!1,"on-change":T,limit:1},{tip:t(()=>e[6]||(e[6]=[o("div",{class:"el-upload__tip"}," 支持TXT文件格式，建议使用UTF-8编码。文件大小不超过10MB。 ",-1)])),default:t(()=>[l(U,{class:"el-icon--upload"},{default:t(()=>[l(h(ne))]),_:1}),e[7]||(e[7]=o("div",{class:"el-upload__text"},[n(" 拖拽文件到此处，或 "),o("em",null,"点击选择文件")],-1))]),_:1}),d.value?(r(),v("div",ve,[o("p",null,[e[8]||(e[8]=o("strong",null,"文件名：",-1)),n(F(d.value.name),1)]),o("p",null,[e[9]||(e[9]=o("strong",null,"大小：",-1)),n(F(J(d.value.size)),1)])])):Q("",!0),o("div",ce,[l(p,{onClick:E},{default:t(()=>e[10]||(e[10]=[n("上一步")])),_:1}),l(p,{type:"primary",loading:y.value,onClick:A},{default:t(()=>[n(F(y.value?"上传中...":"开始上传"),1)]),_:1},8,["loading"])])])):(r(),v("div",_e,[k.value?(r(),w(S,{key:0,icon:"success",title:"上传成功","sub-title":"小说文件已上传，系统正在后台处理中..."},{extra:t(()=>[l(p,{type:"primary",onClick:L},{default:t(()=>e[11]||(e[11]=[n("查看小说详情")])),_:1}),l(p,{onClick:q},{default:t(()=>e[12]||(e[12]=[n("再次上传")])),_:1})]),_:1})):(r(),w(S,{key:1,icon:"error",title:"上传失败","sub-title":c.value||"小说上传过程中发生错误"},{extra:t(()=>[l(p,{onClick:E},{default:t(()=>e[13]||(e[13]=[n("返回重试")])),_:1}),l(p,{type:"primary",onClick:G},{default:t(()=>e[14]||(e[14]=[n("返回列表")])),_:1})]),_:1},8,["sub-title"]))]))])]),_:1})])}}},we=H(me,[["__scopeId","data-v-0de0a9c9"]]);export{we as default};
