import{_ as F,u as G,P as J,a as O,A as E,o as Q,B as v,b as l,d,e as o,w as s,l as U,f as n,h as I,Q as b,R as N,g as i,i as _,a0 as H,k as K,n as W,G as X,E as Y,t as g,j as z,a1 as Z,p as ee,$ as ae,m as te}from"./index-9820d523.js";/* empty css               *//* empty css                *//* empty css               *//* empty css                         *//* empty css                 *//* empty css                  */import{c as se}from"./character-cf834eae.js";const le={class:"character-list-container"},oe={class:"page-header"},ne={class:"header-actions"},re={key:1,class:"loading-container"},ie={key:3,class:"character-list"},ce={class:"character-avatar"},de={class:"character-info"},ue={class:"character-name"},_e={class:"character-description"},pe={key:0,class:"character-aliases"},ve={class:"alias-tags"},me={key:0},fe={class:"character-actions"},ye={__name:"CharacterList",setup(ge){const h=G(),A=J(),m=O(),c=E(null),p=E([]),f=E(!1);Q(async()=>{m.novels.length===0&&await m.fetchNovels();const a=Number(A.query.novelId);a&&!isNaN(a)&&(c.value=a,await k(a))});async function k(a,e=!1){if(a)try{p.value=[],f.value=!0;const r=await se.analyzeCharacters(a,e);console.log("角色分析API响应:",r),r&&Array.isArray(r)?(p.value=[...r].sort((C,u)=>(u.importance||0)-(C.importance||0)),v.success(`成功加载小说角色，共发现${r.length}个角色`)):(v.warning("获取到的角色列表为空"),p.value=[])}catch(r){console.error("获取角色列表失败:",r),v.error("获取角色列表失败: "+(r.message||"未知错误")),p.value=[]}finally{f.value=!1}}async function R(a){await k(a),h.replace({query:{...A.query,novelId:a}})}async function V(){if(c.value)try{await k(c.value,!0)}catch{v.error("分析角色失败")}}function S(){h.push("/novels/list")}function $(a){v.info("角色详情功能开发中")}function q(a){h.push({path:"/analysis/characters/journey",query:{novelId:c.value,characterId:a}})}function L(a){return`https://avatars.dicebear.com/api/avataaars/${a||Math.random()}.svg`}function T(a,e){return!a||a.length<=e?a:a.substring(0,e)+"..."}return(a,e)=>{const r=Z,C=H,u=K,B=W,M=X,j=ee,w=ae,x=U,D=te,P=Y;return l(),d("div",le,[o(x,{shadow:"never"},{header:s(()=>[n("div",oe,[e[2]||(e[2]=n("h2",null,"角色列表",-1)),n("div",ne,[o(C,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),placeholder:"请选择小说",onChange:R,loading:I(m).loading,class:"full-width-select"},{default:s(()=>[(l(!0),d(b,null,N(I(m).novels,t=>(l(),_(r,{key:t.id,label:t.title,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),o(u,{type:"primary",onClick:V,disabled:!c.value,loading:f.value,class:"analyze-button"},{default:s(()=>e[1]||(e[1]=[i(" 分析角色 ")])),_:1},8,["disabled","loading"])])])]),default:s(()=>[c.value?f.value?(l(),d("div",re,[o(M,{rows:5,animated:""}),e[4]||(e[4]=n("div",{class:"loading-text"},"正在分析小说角色...",-1))])):p.value.length===0?(l(),_(B,{key:2,description:"暂无角色数据，点击上方按钮分析角色"},{default:s(()=>[o(u,{type:"primary",onClick:V},{default:s(()=>e[5]||(e[5]=[i("分析角色")])),_:1})]),_:1})):(l(),d("div",ie,[o(P,{gutter:20},{default:s(()=>[(l(!0),d(b,null,N(p.value,t=>(l(),_(D,{key:t.id,xs:24,sm:12,md:8,lg:6,class:"character-col"},{default:s(()=>[o(x,{class:"character-card","body-style":{padding:"10px"},shadow:"hover"},{default:s(()=>[n("div",ce,[o(j,{size:80,src:L(t.id)},null,8,["src"])]),n("div",de,[n("h3",ue,[i(g(t.name)+" ",1),t.importance>=5?(l(),_(w,{key:0,type:"danger",size:"small"},{default:s(()=>e[6]||(e[6]=[i(" 主角 ")])),_:1})):t.importance>=4?(l(),_(w,{key:1,type:"warning",size:"small"},{default:s(()=>e[7]||(e[7]=[i(" 重要 ")])),_:1})):z("",!0)]),n("div",_e,g(T(t.description,60)||"暂无描述"),1),t.alias&&t.alias.length?(l(),d("div",pe,[e[8]||(e[8]=n("div",{class:"aliases-label"},"别名：",-1)),n("div",ve,[(l(!0),d(b,null,N(t.alias.slice(0,3),y=>(l(),_(w,{key:y,size:"small",effect:"plain",class:"alias-tag"},{default:s(()=>[i(g(y),1)]),_:2},1024))),128)),t.alias.length>3?(l(),d("span",me,"等"+g(t.alias.length)+"个",1)):z("",!0)])])):z("",!0),n("div",fe,[o(u,{type:"primary",size:"small",onClick:y=>$(t.id)},{default:s(()=>e[9]||(e[9]=[i(" 详细信息 ")])),_:2},1032,["onClick"]),o(u,{type:"success",size:"small",onClick:y=>q(t.id)},{default:s(()=>e[10]||(e[10]=[i(" 角色旅程 ")])),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(l(),_(B,{key:0,description:"请从上方选择小说"},{default:s(()=>[o(u,{type:"primary",onClick:S},{default:s(()=>e[3]||(e[3]=[i("浏览小说列表")])),_:1})]),_:1}))]),_:1})])}}},Ae=F(ye,[["__scopeId","data-v-6c950c64"]]);export{Ae as default};
