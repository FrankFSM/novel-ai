import{_ as G,u as O,P as Q,a as U,A as h,o as H,B as c,b as l,d as v,e as s,w as n,l as J,f as r,h as N,Q as z,R as B,g as u,i as p,a0 as K,k as W,n as X,G as Y,E as Z,t as x,j as V,a1 as ee,p as te,$ as ne,ao as oe,m as se}from"./index-9820d523.js";/* empty css               *//* empty css                *//* empty css               *//* empty css                         *//* empty css                 *//* empty css                  */import{l as ae}from"./location-23ef2fff.js";const le={class:"location-list-container"},ie={class:"page-header"},re={class:"header-actions"},ue={key:1,class:"loading-container"},ce={key:3,class:"location-list"},de={class:"location-icon"},_e={class:"location-info"},ve={class:"location-name"},pe={class:"location-description"},fe={key:0,class:"location-events"},me={class:"event-count"},ye={class:"location-actions"},ge={__name:"LocationList",setup(ke){const f=O(),E=Q(),m=U(),i=h(null),_=h([]),y=h(!1);H(async()=>{m.novels.length===0&&await m.fetchNovels();const t=Number(E.query.novelId);t&&!isNaN(t)&&(i.value=t,await g(t))});async function g(t,e=!1){if(t)try{_.value=[],y.value=!0;const a=await ae.analyzeLocations(t,e);console.log("地点分析API响应:",a),a&&Array.isArray(a)?(_.value=[...a].sort((k,d)=>(d.events_count||0)-(k.events_count||0)),c.success(`成功加载小说地点，共发现${a.length}个地点`)):(c.warning("获取到的地点列表为空"),_.value=[])}catch(a){console.error("获取地点列表失败:",a),c.error("获取地点列表失败: "+(a.message||"未知错误")),_.value=[]}finally{y.value=!1}}async function A(t){await g(t),f.replace({query:{...E.query,novelId:t}})}async function b(){if(i.value)try{await g(i.value,!0)}catch{c.error("分析地点失败")}}function I(){f.push("/novels/list")}function $(t){if(!t){c.warning("地点ID无效");return}if(!i.value){c.warning("请先选择小说");return}f.push({name:"LocationDetail",params:{locationId:t},query:{novelId:i.value}})}function q(t){if(!t){c.warning("地点ID无效");return}if(!i.value){c.warning("请先选择小说");return}f.push({name:"LocationEvents",params:{locationId:t},query:{novelId:i.value}})}function D(t){const e=["castle","home","mountain","forest","city","beach","cave","building","palace","village"],a=t%e.length;return`https://api.dicebear.com/7.x/bottts/svg?seed=${e[a]}_${t}`}function S(t,e){return!t||t.length<=e?t:t.substring(0,e)+"..."}return(t,e)=>{const a=ee,k=K,d=W,L=X,R=Y,T=te,w=ne,M=oe,C=J,P=se,j=Z;return l(),v("div",le,[s(C,{shadow:"never"},{header:n(()=>[r("div",ie,[e[2]||(e[2]=r("h2",null,"地点列表",-1)),r("div",re,[s(k,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),placeholder:"请选择小说",onChange:A,loading:N(m).loading,class:"full-width-select"},{default:n(()=>[(l(!0),v(z,null,B(N(m).novels,o=>(l(),p(a,{key:o.id,label:o.title,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),s(d,{type:"primary",onClick:b,disabled:!i.value,loading:y.value,class:"analyze-button"},{default:n(()=>e[1]||(e[1]=[u(" 分析地点 ")])),_:1},8,["disabled","loading"])])])]),default:n(()=>[i.value?y.value?(l(),v("div",ue,[s(R,{rows:5,animated:""}),e[4]||(e[4]=r("div",{class:"loading-text"},"正在分析小说地点...",-1))])):_.value.length===0?(l(),p(L,{key:2,description:"暂无地点数据，点击上方按钮分析地点"},{default:n(()=>[s(d,{type:"primary",onClick:b},{default:n(()=>e[5]||(e[5]=[u("分析地点")])),_:1})]),_:1})):(l(),v("div",ce,[s(j,{gutter:20},{default:n(()=>[(l(!0),v(z,null,B(_.value,o=>(l(),p(P,{key:o.id,xs:24,sm:12,md:8,lg:6,class:"location-col"},{default:n(()=>[s(C,{class:"location-card","body-style":{padding:"10px"},shadow:"hover"},{default:n(()=>[r("div",de,[s(T,{size:80,src:D(o.id)},null,8,["src"])]),r("div",_e,[r("h3",ve,[u(x(o.name)+" ",1),o.events_count>=5?(l(),p(w,{key:0,type:"danger",size:"small"},{default:n(()=>e[6]||(e[6]=[u(" 重要 ")])),_:1})):o.events_count>=3?(l(),p(w,{key:1,type:"warning",size:"small"},{default:n(()=>e[7]||(e[7]=[u(" 主要 ")])),_:1})):V("",!0)]),r("div",pe,x(S(o.description,60)||"暂无描述"),1),o.events_count?(l(),v("div",fe,[e[9]||(e[9]=r("div",{class:"events-label"},"相关事件：",-1)),r("div",me,[s(M,{value:o.events_count,type:"primary"},{default:n(()=>[s(w,{type:"info",size:"small"},{default:n(()=>e[8]||(e[8]=[u("事件数量")])),_:1})]),_:2},1032,["value"])])])):V("",!0),r("div",ye,[s(d,{type:"primary",size:"small",onClick:F=>$(o.id)},{default:n(()=>e[10]||(e[10]=[u(" 详细信息 ")])),_:2},1032,["onClick"]),s(d,{type:"success",size:"small",onClick:F=>q(o.id)},{default:n(()=>e[11]||(e[11]=[u(" 相关事件 ")])),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(l(),p(L,{key:0,description:"请从上方选择小说"},{default:n(()=>[s(d,{type:"primary",onClick:I},{default:n(()=>e[3]||(e[3]=[u("浏览小说列表")])),_:1})]),_:1}))]),_:1})])}}},Be=G(ge,[["__scopeId","data-v-999f4fc0"]]);export{Be as default};
