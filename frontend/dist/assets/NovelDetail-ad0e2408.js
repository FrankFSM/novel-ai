import{_ as _t,P as pt,u as ht,a as ft,A as p,c as G,o as mt,B as g,b as c,d as m,e as a,w as s,i as b,G as yt,n as gt,l as wt,C as Ct,f as e,g as _,t as n,h as I,j as P,Q as J,R as X,S as bt,T as kt,k as xt,U as Nt,s as Et,V as Vt,q as St,r as Dt,W as Mt,X as It,Y as Tt,Z as $t,z as At,$ as Lt}from"./index-9820d523.js";/* empty css                   *//* empty css                    *//* empty css               *//* empty css                        *//* empty css                *//* empty css                 *//* empty css                         */const Bt={class:"novel-detail-container"},Pt={key:0,class:"loading-container"},Wt={style:{padding:"14px"}},Ut={style:{display:"flex","align-items":"center","margin-top":"16px"}},zt={key:2},Rt={class:"novel-info"},qt={class:"novel-cover"},Qt={class:"novel-details"},jt={class:"novel-title"},Ft={class:"novel-meta"},Gt={class:"meta-item"},Jt={class:"meta-item"},Xt={key:0,class:"meta-item"},Yt={key:1,class:"meta-item"},Zt={class:"novel-description"},Ht={class:"novel-actions"},Kt={class:"statistics-container"},Ot={class:"centered-content"},te={key:1,class:"statistics-grid"},ee={class:"stat-content"},ae={class:"stat-item"},se={class:"stat-value"},le={class:"stat-item"},oe={class:"stat-value"},ne={class:"stat-item"},ie={class:"stat-value"},re={class:"stat-content"},de={class:"stat-item"},ce={class:"stat-value"},ue={class:"stat-item"},ve={class:"stat-value"},_e={class:"stat-item"},pe={class:"stat-value"},he={class:"stat-content"},fe={class:"stat-item"},me={class:"stat-value"},ye={class:"stat-item"},ge={class:"stat-value"},we={class:"stat-item"},Ce={class:"stat-value"},be={class:"chapters-container"},ke={class:"characters-container"},xe={key:0,class:"chapter-content"},Ne={class:"chapter-header"},Ee={class:"chapter-meta"},Ve={class:"chapter-text"},Se={class:"dialog-footer"},De={__name:"NovelDetail",setup(Me){const Y=pt(),V=ht(),k=ft(),W=p(!0),U=p("statistics"),T=p([]),$=p([]),h=p({}),A=p(!1),M=p(!1),S=p(!1),L=p(!1),x=p(null),D=p(!1),w=G(()=>Number(Y.params.id)),i=G(()=>k.novels.find(l=>l.id===w.value)||null);mt(async()=>{try{await z()}catch{g.error("获取小说详情失败")}finally{W.value=!1}});async function z(){k.novels.length===0&&await k.fetchNovels(),(!i.value||!i.value.chapters_count)&&await k.fetchNovelDetail(w.value),await R(),T.value=it(),$.value=rt()}async function R(){var l,t;try{h.value={chapterCount:((l=i.value)==null?void 0:l.chapters_count)||0,totalWords:15e4,avgWordsPerChapter:5e3,characterCount:((t=i.value)==null?void 0:t.characters_count)||0,mainCharacterCount:5,relationshipCount:20,locationCount:15,itemCount:30,eventCount:45},A.value=!0}catch(r){console.error("获取统计数据失败",r),A.value=!1}}async function Z(){M.value=!0;try{await new Promise(l=>setTimeout(l,1500)),await R(),g.success("统计数据生成成功")}catch{g.error("统计数据生成失败")}finally{M.value=!1}}async function q(){S.value=!0;try{await bt.extractNovelEntities(w.value),g.success("实体提取任务已启动，将在后台处理"),setTimeout(async()=>{try{await z(),g.success("实体提取完成")}finally{S.value=!1}},3e3)}catch{g.error("实体提取失败"),S.value=!1}}function H(l){x.value=l,L.value=!0}function K(l){V.push(`/analysis/characters?novelId=${w.value}&characterId=${l}`)}function O(){k.setCurrentNovel(w.value),V.push("/qa")}function tt(){V.push(`/analysis/relationships?novelId=${w.value}`)}function et(){D.value=!0}async function at(){try{await k.deleteNovel(w.value),D.value=!1,g.success("小说删除成功"),V.push("/novels/list")}catch{g.error("删除小说失败")}}function st(){V.push("/novels/list")}function lt(l){return l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function ot(l){return l==null?"0":Number(l).toLocaleString()}function nt(l){return l?l.split(`
`).filter(t=>t.trim()!==""):[]}function it(){var r;const l=((r=i.value)==null?void 0:r.chapters_count)||10,t=[];for(let u=1;u<=l;u++)t.push({id:u,number:u,title:`第${u}章 ${u%3===0?"惊天大战":u%3===1?"神秘来客":"隐藏真相"}`,word_count:Math.floor(3e3+Math.random()*4e3),content:`这是第${u}章的内容。

这是一个段落。

这是另一个段落，包含了这一章的主要内容和情节发展。`});return t}function rt(){var d;const l=((d=i.value)==null?void 0:d.characters_count)||5,t=[],r=["林远","沈清雪","张天志","李墨","王霜","赵云","钱多多","孙小圣"],u=["主角，拥有神秘血脉","女主角，冰系法术天才","男主角的挚友，武道奇才","隐世宗门弟子","神秘组织成员","资深猎人，身手不凡","富商之女，精通商业","顽皮捣蛋，身份成谜"];for(let v=0;v<l;v++){const C=v%r.length;t.push({id:v+1,name:r[C],alias:dt(r[C]),description:u[C]})}return t}function dt(l){const t=Math.floor(Math.random()*3),r=[],u=["小","老","大"],d=["哥","姐","兄","弟"];for(let v=0;v<t;v++)if(v===0&&l.length<=2)r.push(l.charAt(l.length-1));else{const C=u[Math.floor(Math.random()*u.length)],N=d[Math.floor(Math.random()*d.length)];r.push(v%2===0?C+l.charAt(l.length-1):l.charAt(l.length-1)+N)}return r}return(l,t)=>{var F;const r=kt,u=yt,d=xt,v=gt,C=Nt,N=Et,E=wt,B=Vt,f=St,Q=Dt,ct=Lt,ut=Mt,j=Ct;return c(),m("div",Bt,[W.value?(c(),m("div",Pt,[a(u,{style:{width:"100%"},animated:""},{template:s(()=>[a(r,{variant:"image",style:{width:"240px",height:"340px"}}),e("div",Wt,[a(r,{variant:"h1",style:{width:"50%"}}),e("div",Ut,[a(r,{variant:"text",style:{"margin-right":"16px",width:"30%"}}),a(r,{variant:"text",style:{width:"30%"}})]),a(r,{variant:"text",style:{width:"100%","margin-top":"16px"}}),a(r,{variant:"text",style:{width:"100%"}})])]),_:1})])):i.value?(c(),m("div",zt,[a(E,{shadow:"never",class:"info-card"},{default:s(()=>[e("div",Rt,[e("div",qt,[a(C,{src:i.value.cover_url||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",fit:"cover","preview-src-list":i.value.cover_url?[i.value.cover_url]:[]},null,8,["src","preview-src-list"])]),e("div",Qt,[e("h1",jt,n(i.value.title),1),e("div",Ft,[e("div",Gt,[a(N,null,{default:s(()=>[a(I(It))]),_:1}),e("span",null,n(i.value.author),1)]),e("div",Jt,[a(N,null,{default:s(()=>[a(I(Tt))]),_:1}),e("span",null,"创建于 "+n(lt(i.value.created_at)),1)]),i.value.chapters_count?(c(),m("div",Xt,[a(N,null,{default:s(()=>[a(I($t))]),_:1}),e("span",null,n(i.value.chapters_count)+" 章节",1)])):P("",!0),i.value.characters_count?(c(),m("div",Yt,[a(N,null,{default:s(()=>[a(I(At))]),_:1}),e("span",null,n(i.value.characters_count)+" 角色",1)])):P("",!0)]),e("div",Zt,[e("p",null,n(i.value.description),1)]),e("div",Ht,[a(d,{type:"primary",onClick:O},{default:s(()=>t[5]||(t[5]=[_("开始问答")])),_:1}),a(d,{type:"success",onClick:tt},{default:s(()=>t[6]||(t[6]=[_("分析小说")])),_:1}),a(d,{type:"danger",onClick:et},{default:s(()=>t[7]||(t[7]=[_("删除小说")])),_:1})])])])]),_:1}),a(E,{shadow:"never",class:"content-card"},{default:s(()=>[a(ut,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=o=>U.value=o)},{default:s(()=>[a(B,{label:"统计信息",name:"statistics"},{default:s(()=>[e("div",Kt,[A.value?(c(),m("div",te,[a(E,{shadow:"hover",class:"stat-card"},{header:s(()=>t[9]||(t[9]=[e("div",{class:"stat-header"},[e("h3",null,"章节统计")],-1)])),default:s(()=>{var o;return[e("div",ee,[e("div",ae,[e("div",se,n(h.value.chapterCount||0),1),t[10]||(t[10]=e("div",{class:"stat-label"},"总章节数",-1))]),e("div",le,[e("div",oe,n(((o=h.value.totalWords)==null?void 0:o.toLocaleString())||0),1),t[11]||(t[11]=e("div",{class:"stat-label"},"总字数",-1))]),e("div",ne,[e("div",ie,n(ot(h.value.avgWordsPerChapter)),1),t[12]||(t[12]=e("div",{class:"stat-label"},"平均章节字数",-1))])])]}),_:1}),a(E,{shadow:"hover",class:"stat-card"},{header:s(()=>t[13]||(t[13]=[e("div",{class:"stat-header"},[e("h3",null,"人物统计")],-1)])),default:s(()=>[e("div",re,[e("div",de,[e("div",ce,n(h.value.characterCount||0),1),t[14]||(t[14]=e("div",{class:"stat-label"},"角色总数",-1))]),e("div",ue,[e("div",ve,n(h.value.mainCharacterCount||0),1),t[15]||(t[15]=e("div",{class:"stat-label"},"主要角色",-1))]),e("div",_e,[e("div",pe,n(h.value.relationshipCount||0),1),t[16]||(t[16]=e("div",{class:"stat-label"},"关系总数",-1))])])]),_:1}),a(E,{shadow:"hover",class:"stat-card"},{header:s(()=>t[17]||(t[17]=[e("div",{class:"stat-header"},[e("h3",null,"其他统计")],-1)])),default:s(()=>[e("div",he,[e("div",fe,[e("div",me,n(h.value.locationCount||0),1),t[18]||(t[18]=e("div",{class:"stat-label"},"地点数量",-1))]),e("div",ye,[e("div",ge,n(h.value.itemCount||0),1),t[19]||(t[19]=e("div",{class:"stat-label"},"物品数量",-1))]),e("div",we,[e("div",Ce,n(h.value.eventCount||0),1),t[20]||(t[20]=e("div",{class:"stat-label"},"事件数量",-1))])])]),_:1})])):(c(),b(E,{key:0,shadow:"hover",class:"empty-statistics"},{default:s(()=>[e("div",Ot,[t[8]||(t[8]=e("p",null,"小说统计数据尚未生成",-1)),a(d,{type:"primary",onClick:Z,loading:M.value},{default:s(()=>[_(n(M.value?"生成中...":"生成统计数据"),1)]),_:1},8,["loading"])])]),_:1}))])]),_:1}),a(B,{label:"章节列表",name:"chapters"},{default:s(()=>[e("div",be,[T.value.length?(c(),b(Q,{key:1,data:T.value,style:{width:"100%"},"max-height":"500"},{default:s(()=>[a(f,{type:"index",width:"50"}),a(f,{prop:"number",label:"序号",width:"80"}),a(f,{prop:"title",label:"章节标题","min-width":"200"}),a(f,{prop:"word_count",label:"字数",width:"100"},{default:s(o=>{var y;return[_(n(((y=o.row.word_count)==null?void 0:y.toLocaleString())||"-"),1)]}),_:1}),a(f,{label:"操作",width:"180"},{default:s(o=>[a(d,{link:"",type:"primary",onClick:y=>H(o.row)},{default:s(()=>t[22]||(t[22]=[_(" 预览 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(c(),b(v,{key:0,description:"暂无章节信息"},{default:s(()=>[a(d,{type:"primary",onClick:q,loading:S.value},{default:s(()=>t[21]||(t[21]=[_("提取实体")])),_:1},8,["loading"])]),_:1}))])]),_:1}),a(B,{label:"角色列表",name:"characters"},{default:s(()=>[e("div",ke,[$.value.length?(c(),b(Q,{key:1,data:$.value,style:{width:"100%"},"max-height":"500"},{default:s(()=>[a(f,{type:"index",width:"50"}),a(f,{prop:"name",label:"名称","min-width":"150"}),a(f,{prop:"alias",label:"别名","min-width":"200"},{default:s(o=>[(c(!0),m(J,null,X(o.row.alias,y=>(c(),b(ct,{key:y,size:"small",style:{"margin-right":"5px"}},{default:s(()=>[_(n(y),1)]),_:2},1024))),128))]),_:1}),a(f,{prop:"description",label:"描述","min-width":"250","show-overflow-tooltip":!0}),a(f,{label:"操作",width:"180"},{default:s(o=>[a(d,{link:"",type:"primary",onClick:y=>K(o.row.id)},{default:s(()=>t[24]||(t[24]=[_(" 角色旅程 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(c(),b(v,{key:0,description:"暂无角色信息"},{default:s(()=>[a(d,{type:"primary",onClick:q,loading:S.value},{default:s(()=>t[23]||(t[23]=[_("提取实体")])),_:1},8,["loading"])]),_:1}))])]),_:1})]),_:1},8,["modelValue"])]),_:1})])):(c(),b(v,{key:1,description:"小说不存在或已被删除"},{default:s(()=>[a(d,{type:"primary",onClick:st},{default:s(()=>t[4]||(t[4]=[_("返回列表")])),_:1})]),_:1})),a(j,{modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=o=>L.value=o),title:((F=x.value)==null?void 0:F.title)||"章节预览",width:"60%"},{default:s(()=>{var o;return[x.value?(c(),m("div",xe,[e("div",Ne,[e("h3",null,n(x.value.title),1),e("div",Ee,[e("span",null,"字数："+n(((o=x.value.word_count)==null?void 0:o.toLocaleString())||"未知"),1)])]),e("div",Ve,[(c(!0),m(J,null,X(nt(x.value.content),(y,vt)=>(c(),m("p",{key:vt},n(y),1))),128))])])):P("",!0)]}),_:1},8,["modelValue","title"]),a(j,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=o=>D.value=o),title:"确认删除",width:"30%"},{footer:s(()=>[e("span",Se,[a(d,{onClick:t[2]||(t[2]=o=>D.value=!1)},{default:s(()=>t[25]||(t[25]=[_("取消")])),_:1}),a(d,{type:"danger",onClick:at},{default:s(()=>t[26]||(t[26]=[_("确定删除")])),_:1})])]),default:s(()=>{var o;return[e("span",null,"确定要删除小说《"+n((o=i.value)==null?void 0:o.title)+"》吗？此操作不可恢复！",1)]}),_:1},8,["modelValue"])])}}},Ue=_t(De,[["__scopeId","data-v-72f46823"]]);export{Ue as default};
