import{_ as ee,u as te,P as le,a as ae,A as T,o as ne,c as z,B,b as i,d,e as o,w as n,l as ie,f as s,h as p,Q as N,R as w,g as m,i as c,a0 as oe,s as se,k as re,ag as ue,al as ce,n as de,G as pe,M as me,a8 as _e,am as fe,Y as ve,t as k,j as I,a1 as ye,$ as ge,ab as he}from"./index-9820d523.js";/* empty css                *//* empty css                         *//* empty css               *//* empty css                  *//* empty css                         *//* empty css                 *//* empty css                  */import{u as ke}from"./analysis-dd34ca86.js";const Ce={class:"timeline-container"},Ee={class:"page-header"},be={class:"header-actions"},Te={key:1,class:"loading-container"},Ne={key:4,class:"timeline-content"},we={class:"timeline-filter"},Ve={class:"timeline-event"},qe={class:"event-header"},xe={class:"event-title"},Be={class:"event-indicators"},Ie={class:"event-body"},Se={class:"event-description"},$e={key:0,class:"event-participants"},Fe={class:"event-actions"},Me={__name:"Timeline",setup(ze){const V=te(),C=le(),E=ae(),r=ke(),u=T(null),f=T(null),b=T([]),h=T("chapter"),_=T(["重要事件","战斗","情感","发现"]);ne(async()=>{E.novels.length===0&&await E.fetchNovels();const t=Number(C.query.novelId),e=Number(C.query.characterId);t&&!isNaN(t)&&E.novels.find(a=>a.id===t)&&(u.value=t,await S(),e&&!isNaN(e)&&b.value.find(a=>a.id===e)&&(f.value=e),q())});const A=z(()=>{if(!r.timeline)return["重要事件","战斗","情感","发现","旅行"];const t=new Set(["重要事件"]);return r.timeline.events.forEach(e=>{e.tags&&e.tags.length&&e.tags.forEach(a=>t.add(a))}),Array.from(t)}),R=z(()=>{if(!r.timeline)return[];let t=r.timeline.events;return h.value==="chapter"?t=[...t].sort((e,a)=>e.chapter_id!==a.chapter_id?e.chapter_id-a.chapter_id:a.importance-e.importance):t=[...t].sort((e,a)=>e.time_description&&a.time_description?e.time_position-a.time_position:e.chapter_id-a.chapter_id),_.value.length>0&&(t=t.filter(e=>!!(_.value.includes("重要事件")&&e.importance>=4||e.tags&&e.tags.some(a=>_.value.includes(a))))),f.value&&(t=t.filter(e=>e.participants&&e.participants.some(a=>a.character_id===f.value))),t});async function S(t){try{b.value=Y()}catch{B.error("获取角色列表失败"),b.value=[]}}async function D(t){f.value=null,r.reset(),await S(),V.replace({query:{...C.query,novelId:t}})}function G(t){if(t)V.replace({query:{...C.query,characterId:t}});else{const{characterId:e,...a}=C.query;V.replace({query:a})}}async function q(){if(u.value)try{await r.fetchTimeline(u.value,f.value)}catch{B.error("生成时间线失败")}}function L(t){_.value.includes(t)?_.value=_.value.filter(e=>e!==t):_.value.push(t)}function U(){V.push("/novels/list")}function j(t){B.info(`查看第${t}章原文`)}function O(t){return h.value==="time"&&t.time_description?t.time_description:`第${t.chapter_id}章`}function P(t){return t.importance>=5?"danger":t.importance>=4?"warning":t.importance>=3?"primary":"info"}function Q(t){if(t.tags){if(t.tags.includes("战斗"))return"#F56C6C";if(t.tags.includes("情感"))return"#FC9DB1";if(t.tags.includes("发现"))return"#E6A23C";if(t.tags.includes("旅行"))return"#409EFF"}return""}function Y(){const e=[],a=["林远","沈清雪","张天志","李墨","王霜","赵云","钱多多","孙小圣","周天","吴明"];for(let v=0;v<10;v++)e.push({id:v+1,name:a[v%a.length]});return e}return(t,e)=>{const a=ye,v=oe,$=se,y=re,F=ue,H=ce,M=de,J=pe,K=me,x=ge,W=he,X=_e,Z=ie;return i(),d("div",Ce,[o(Z,{shadow:"never"},{header:n(()=>[s("div",Ee,[e[5]||(e[5]=s("h2",null,"情节时间线",-1)),s("div",be,[o(v,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),placeholder:"请选择小说",onChange:D,loading:p(E).loading},{default:n(()=>[(i(!0),d(N,null,w(p(E).novels,l=>(i(),c(a,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),o(v,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),placeholder:"筛选角色（可选）",clearable:"",onChange:G,disabled:!u.value||!b.value.length},{default:n(()=>[(i(!0),d(N,null,w(b.value,l=>(i(),c(a,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),o(H,null,{default:n(()=>[o(F,{content:"按章节顺序"},{default:n(()=>[o(y,{type:h.value==="chapter"?"primary":"",onClick:e[2]||(e[2]=l=>h.value="chapter"),disabled:!u.value},{default:n(()=>[o($,null,{default:n(()=>[o(p(fe))]),_:1})]),_:1},8,["type","disabled"])]),_:1}),o(F,{content:"按时间顺序"},{default:n(()=>[o(y,{type:h.value==="time"?"primary":"",onClick:e[3]||(e[3]=l=>h.value="time"),disabled:!u.value},{default:n(()=>[o($,null,{default:n(()=>[o(p(ve))]),_:1})]),_:1},8,["type","disabled"])]),_:1})]),_:1}),o(y,{type:"primary",onClick:q,disabled:!u.value,loading:p(r).loading},{default:n(()=>e[4]||(e[4]=[m(" 生成时间线 ")])),_:1},8,["disabled","loading"])])])]),default:n(()=>[u.value?p(r).loading?(i(),d("div",Te,[o(J,{rows:15,animated:""})])):p(r).error?(i(),c(K,{key:2,icon:"error",title:"加载失败","sub-title":p(r).error},{extra:n(()=>[o(y,{type:"primary",onClick:q},{default:n(()=>e[7]||(e[7]=[m("重试")])),_:1})]),_:1},8,["sub-title"])):p(r).timeline?(i(),d("div",Ne,[s("div",we,[(i(!0),d(N,null,w(A.value,(l,g)=>(i(),c(x,{key:g,type:_.value.includes(l)?"":"info",effect:"plain",class:"filter-tag",onClick:Ae=>L(l)},{default:n(()=>[m(k(l),1)]),_:2},1032,["type","onClick"]))),128))]),o(X,null,{default:n(()=>[(i(!0),d(N,null,w(R.value,l=>(i(),c(W,{key:l.id,timestamp:O(l),type:P(l),color:Q(l),placement:"top",hollow:l.importance<4},{default:n(()=>[s("div",Ve,[s("div",qe,[s("span",xe,k(l.name),1),s("div",Be,[l.importance>=4?(i(),c(x,{key:0,size:"small",type:"danger"},{default:n(()=>e[9]||(e[9]=[m("重要")])),_:1})):I("",!0),l.location?(i(),c(x,{key:1,size:"small",type:"warning"},{default:n(()=>[m(k(l.location.name),1)]),_:2},1024)):I("",!0)])]),s("div",Ie,[s("p",Se,k(l.description),1),l.participants&&l.participants.length>0?(i(),d("div",$e,[e[10]||(e[10]=s("span",{class:"label"},"相关角色：",-1)),(i(!0),d(N,null,w(l.participants,g=>(i(),c(x,{key:g.character_id,size:"small",style:{"margin-right":"5px"}},{default:n(()=>[m(k(g.character_name)+k(g.role?`(${g.role})`:""),1)]),_:2},1024))),128))])):I("",!0),s("div",Fe,[o(y,{link:"",type:"primary",size:"small",onClick:g=>j(l.chapter_id)},{default:n(()=>e[11]||(e[11]=[m(" 查看原文 ")])),_:2},1032,["onClick"])])])])]),_:2},1032,["timestamp","type","color","hollow"]))),128))]),_:1})])):(i(),c(M,{key:3,description:"点击上方按钮生成情节时间线"},{default:n(()=>[o(y,{type:"primary",onClick:q},{default:n(()=>e[8]||(e[8]=[m("生成时间线")])),_:1})]),_:1})):(i(),c(M,{key:0,description:"请从上方选择一本小说以查看情节时间线"},{default:n(()=>[o(y,{type:"primary",onClick:U},{default:n(()=>e[6]||(e[6]=[m("浏览小说列表")])),_:1})]),_:1}))]),_:1})])}}},Ye=ee(Me,[["__scopeId","data-v-2a4afe90"]]);export{Ye as default};
